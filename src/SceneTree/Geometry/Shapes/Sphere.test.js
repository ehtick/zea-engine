import { Sphere } from './Sphere'
import { Vec3 } from '../../../Math'

describe('Sphere', () => {
  test('test default parameters.', () => {
    const sphere = new Sphere()

    expect(sphere.getParameter('Radius').getValue()).toBe(1.0)
    expect(sphere.getParameter('Sides').getValue()).toBe(12)
    expect(sphere.getParameter('Loops').getValue()).toBe(12)
  })

  test('test update parameters.', () => {
    const sphere = new Sphere()
    sphere.getParameter('Radius').setValue(2.6)
    sphere.getParameter('Sides').setValue(24)
    sphere.getParameter('Loops').setValue(30)

    expect(sphere.getParameter('Radius').getValue()).toBe(2.6)
    expect(sphere.getParameter('Sides').getValue()).toBe(24)
    expect(sphere.getParameter('Loops').getValue()).toBe(30)
  })

  it('saves to JSON (serialization).', () => {
    const sphere = new Sphere(2.6, 5, 5)
    const outputJSON = sphere.toJSON()

    expect(outputJSON).toMatchSnapshot()
  })

  it('restores from JSON (serialization).', () => {
    const sphere = new Sphere()
    const inputStr =
      '{"params":{"Radius":{"value":2.6},"Sides":{"value":5,"range":[3,200],"step":1},"Loops":{"value":5,"range":[3,200],"step":1}},"type":"Sphere","numVertices":27,"vertexAttributes":{"positions":{"data":[0,0,2.5999999046325684,1.2999999523162842,0,2.2516660690307617,0.40172210335731506,1.2363735437393188,2.2516660690307617,-1.0517220497131348,0.7641208171844482,2.2516660690307617,-1.0517220497131348,-0.7641208171844482,2.2516660690307617,0.40172210335731506,-1.2363735437393188,2.2516660690307617,2.2516660690307617,0,1.2999999523162842,0.6958031058311462,2.1414616107940674,1.2999999523162842,-1.8216361999511719,1.3234961032867432,1.2999999523162842,-1.8216361999511719,-1.3234961032867432,1.2999999523162842,0.6958031058311462,-2.1414616107940674,1.2999999523162842,2.5999999046325684,0,1.5920409083607182e-16,0.8034442067146301,2.4727470874786377,1.5920409083607182e-16,-2.1034440994262695,1.5282416343688965,1.5920409083607182e-16,-2.1034440994262695,-1.5282416343688965,1.5920409083607182e-16,0.8034442067146301,-2.4727470874786377,1.5920409083607182e-16,2.2516660690307617,0,-1.2999999523162842,0.6958031058311462,2.1414616107940674,-1.2999999523162842,-1.8216361999511719,1.3234961032867432,-1.2999999523162842,-1.8216361999511719,-1.3234961032867432,-1.2999999523162842,0.6958031058311462,-2.1414616107940674,-1.2999999523162842,1.2999999523162842,0,-2.2516660690307617,0.40172210335731506,1.2363735437393188,-2.2516660690307617,-1.0517220497131348,0.7641208171844482,-2.2516660690307617,-1.0517220497131348,-0.7641208171844482,-2.2516660690307617,0.40172210335731506,-1.2363735437393188,-2.2516660690307617,0,0,-2.5999999046325684],"dataType":"Vec3","defaultValue":0,"length":27,"splits":{},"splitValues":[]},"texCoords":{"data":[0.5,0,1,0.1666666716337204,0.800000011920929,0,0.6000000238418579,0,0.4000000059604645,0,0.20000000298023224,0,0.20000000298023224,0,0.20000000298023224,0.20000000298023224,0.20000000298023224,0.4000000059604645,0.20000000298023224,0.6000000238418579,0.20000000298023224,0.800000011920929,0.4000000059604645,0,0.4000000059604645,0.20000000298023224,0.4000000059604645,0.4000000059604645,0.4000000059604645,0.6000000238418579,0.4000000059604645,0.800000011920929,0.6000000238418579,0,0.6000000238418579,0.20000000298023224,0.6000000238418579,0.4000000059604645,0.6000000238418579,0.6000000238418579,0.6000000238418579,0.800000011920929,0.800000011920929,0.8333333134651184,0.5,1,0.5,1,0.5,1,0.5,1,1,0.8333333134651184],"dataType":"Vec2","defaultValue":1.7976931348623157e+308,"length":27,"splits":{"1":{"4":3,"10":3,"14":18},"2":{"1":0,"10":14,"11":14},"3":{"2":1,"11":15,"12":15},"4":{"3":2,"12":16,"13":16},"5":{"4":4,"13":17,"14":17},"6":{"14":19,"19":19},"11":{"19":20,"24":20},"16":{"24":21,"29":21},"21":{"9":13,"25":23,"29":27},"22":{"6":6,"25":22,"26":22},"23":{"7":8,"26":24,"27":24},"24":{"8":10,"27":25,"28":25},"25":{"9":12,"28":26,"29":26},"26":{"6":5,"7":7,"8":9,"9":11}},"splitValues":[{"x":0.800000011920929,"y":0.1666666716337204},{"x":0.6000000238418579,"y":0.1666666716337204},{"x":0.4000000059604645,"y":0.1666666716337204},{"x":0,"y":0},{"x":0.20000000298023224,"y":0.1666666716337204},{"x":0.800000011920929,"y":0.8333333134651184},{"x":0.6000000238418579,"y":0.8333333134651184},{"x":0.6000000238418579,"y":0.8333333134651184},{"x":0.4000000059604645,"y":0.8333333134651184},{"x":0.4000000059604645,"y":0.8333333134651184},{"x":0.20000000298023224,"y":0.8333333134651184},{"x":0.20000000298023224,"y":0.8333333134651184},{"x":0,"y":0.8333333134651184},{"x":0.5,"y":1},{"x":0,"y":0.20000000298023224},{"x":0,"y":0.4000000059604645},{"x":0,"y":0.6000000238418579},{"x":0,"y":0.800000011920929},{"x":0,"y":1},{"x":0.20000000298023224,"y":1},{"x":0.4000000059604645,"y":1},{"x":0.6000000238418579,"y":1},{"x":0.800000011920929,"y":0.20000000298023224},{"x":0.800000011920929,"y":0},{"x":0.800000011920929,"y":0.4000000059604645},{"x":0.800000011920929,"y":0.6000000238418579},{"x":0.800000011920929,"y":0.800000011920929},{"x":0.800000011920929,"y":1}]},"normals":{"data":[0,0,1,0.5,0,0.8660253882408142,0.15450850129127502,0.4755282700061798,0.8660253882408142,-0.404508501291275,0.29389262199401855,0.8660253882408142,-0.404508501291275,-0.29389262199401855,0.8660253882408142,0.15450850129127502,-0.4755282700061798,0.8660253882408142,0.8660253882408142,0,0.5,0.2676165699958801,0.8236390948295593,0.5,-0.7006292939186096,0.5090369582176208,0.5,-0.7006292939186096,-0.5090369582176208,0.5,0.2676165699958801,-0.8236390948295593,0.5,1,0,6.123234262925839e-17,0.30901700258255005,0.9510565400123596,6.123234262925839e-17,-0.80901700258255,0.5877852439880371,6.123234262925839e-17,-0.80901700258255,-0.5877852439880371,6.123234262925839e-17,0.30901700258255005,-0.9510565400123596,6.123234262925839e-17,0.8660253882408142,0,-0.5,0.2676165699958801,0.8236390948295593,-0.5,-0.7006292939186096,0.5090369582176208,-0.5,-0.7006292939186096,-0.5090369582176208,-0.5,0.2676165699958801,-0.8236390948295593,-0.5,0.5,0,-0.8660253882408142,0.15450850129127502,0.4755282700061798,-0.8660253882408142,-0.404508501291275,0.29389262199401855,-0.8660253882408142,-0.404508501291275,-0.29389262199401855,-0.8660253882408142,0.15450850129127502,-0.4755282700061798,-0.8660253882408142,0,0,-1],"dataType":"Vec3","defaultValue":1.7976931348623157e+308,"length":27,"splits":{},"splitValues":[]}},"faceCounts":[10,25],"faceVertexIndices":[0,2,1,0,3,2,0,4,3,0,5,4,0,1,5,26,21,22,26,22,23,26,23,24,26,24,25,26,25,21,1,2,7,6,2,3,8,7,3,4,9,8,4,5,10,9,5,1,6,10,6,7,12,11,7,8,13,12,8,9,14,13,9,10,15,14,10,6,11,15,11,12,17,16,12,13,18,17,13,14,19,18,14,15,20,19,15,11,16,20,16,17,22,21,17,18,23,22,18,19,24,23,19,20,25,24,20,16,21,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}'
    sphere.fromJSON(JSON.parse(inputStr))

    expect(sphere.toJSON()).toEqual(new Sphere(2.6, 5, 5).toJSON())
  })
})
