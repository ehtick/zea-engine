<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Zea Inc. Demo</title>

    <style>
      html,
      body,
      #root {
        height: 100%;
        width: 100%;
        padding: 0;
        margin: 0;
        font-family: 'Roboto', sans-serif;
      }

      input,
      button {
        font-family: 'Roboto', sans-serif;
      }
    </style>
  </head>
  <body>
    <canvas id="root"></canvas>

    <script src="../dist/index.umd.js"></script>
    <script>
      const {
        GLRenderer,
        Scene,
        TreeItem,
        Group,
        GeomItem,
        Cuboid,
        Cylinder,
        Torus,
        Cone,
        Xfo,
        Vec3,
        Color,
        Material,
        BillboardItem,
        Label,
      } = window.zeaEngine

      const domElement = document.getElementById('root')

      const scene = new Scene()
      scene.setupGrid(10.0, 10)

      const renderer = new GLRenderer(domElement)

      /** Add Label Start */
      let index = 0
      const addLabel = (pos, color, name) => {
        const label = new Label(name)
        label.getParameter('FontSize').setValue(28)
        label.getParameter('BackgroundColor').setValue(color)

        const billboard = new BillboardItem('billboard' + index, label)
        billboard.getParameter('LocalXfo').setValue(new Xfo(pos))
        billboard.getParameter('PixelsPerMeter').setValue(300)
        billboard.getParameter('AlignedToCamera').setValue(true)
        billboard.getParameter('DrawOnTop').setValue(true)
        billboard.getParameter('Alpha').setValue(1)

        scene.getRoot().addChild(billboard)

        index++
        return label
      }

      /** Add Label End */

      /** Self Events Start */
      {
        const material1 = new Material('material1', 'SimpleSurfaceShader')
        material1.getParameter('BaseColor').setValue(new Color('#94C47D'))

        const selfEventItem = new GeomItem('CuboidGeometryItem', new Cuboid(0.7, 0.7, 0.7), material1)

        const selfEventItemXfo = new Xfo()
        selfEventItemXfo.tr = new Vec3(2, 0, 0.5)
        selfEventItem.getParameter('GlobalXfo').setValue(selfEventItemXfo)

        const labelDefaultText = 'Self Event Handling'
        const selfEventItemLabel = addLabel(new Vec3(2, 0, 1.5), new Color('#94C47D'), labelDefaultText)

        scene.getRoot().addChild(selfEventItem)

        let goToDefaultTextTimeout

        const startBackToDefaultTextTimeout = () => {
          goToDefaultTextTimeout = setTimeout(
            () => selfEventItemLabel.getParameter('Text').setValue(labelDefaultText),
            2000
          )
        }

        // Registering pointer event handlers directly to the geometry.
        selfEventItem.on('pointerEnter', (event) => {
          event.stopPropagation()

          selfEventItemLabel.getParameter('Text').setValue(`<pointerEnter> event`)
          clearTimeout(goToDefaultTextTimeout)
        })

        selfEventItem.on('pointerLeave', (event) => {
          event.stopPropagation()

          selfEventItemLabel.getParameter('Text').setValue(`<pointerLeave> event`)
          startBackToDefaultTextTimeout()
        })

        selfEventItem.on('pointerDown', (event) => {
          event.stopPropagation()

          selfEventItemLabel.getParameter('Text').setValue(`<pointerDown> event`)
          clearTimeout(goToDefaultTextTimeout)
        })

        selfEventItem.on('pointerUp', (event) => {
          event.stopPropagation()
          selfEventItemLabel.getParameter('Text').setValue(`<pointerUp> event`)
          startBackToDefaultTextTimeout()
        })
      }

      /** Self Events End */

      /** Group Events Start */
      {
        const material2 = new Material('material2', 'SimpleSurfaceShader')
        material2.getParameter('BaseColor').setValue(new Color('#F6B26B'))

        const groupItem1 = new GeomItem('CylinderGeometryItem', new Cylinder(0.3, 0.4), material2)

        const groupItem1Xfo = new Xfo()
        groupItem1Xfo.tr = new Vec3(0.35, 0, 0.5)
        groupItem1.getParameter('GlobalXfo').setValue(groupItem1Xfo)

        // ----------------------------------------------------------------------------------------

        const material3 = new Material('cylinderMaterial', 'SimpleSurfaceShader')
        material3.getParameter('BaseColor').setValue(new Color('#F6B26B'))

        const groupItem2 = new GeomItem('CylinderGeometryItem', new Torus(0.1, 0.3), material3)

        const groupItem2Xfo = new Xfo()
        groupItem2Xfo.tr = new Vec3(-0.45, 0, 0.5)
        groupItem2.getParameter('GlobalXfo').setValue(groupItem2Xfo)

        // ----------------------------------------------------------------------------------------

        scene.getRoot().addChild(groupItem1)
        scene.getRoot().addChild(groupItem2)

        const group = new Group('MyGroup')
        group.addItem(groupItem1)
        group.addItem(groupItem2)

        const labelDefaultText = 'Group Event Handling'
        const groupEventItemLabel = addLabel(new Vec3(0, 0, 1.5), new Color('#F6B26B'), labelDefaultText)

        let goToDefaultTextTimeout
        const startBackToDefaultTextTimeout = () => {
          goToDefaultTextTimeout = setTimeout(
            () => groupEventItemLabel.getParameter('Text').setValue(labelDefaultText),
            2000
          )
        }

        // Registering pointer event handlers directly to the geometry.
        group.on('pointerEnter', (event) => {
          event.stopPropagation()

          groupEventItemLabel.getParameter('Text').setValue(`<pointerEnter> event`)
          clearTimeout(goToDefaultTextTimeout)
        })

        group.on('pointerLeave', (event) => {
          event.stopPropagation()

          groupEventItemLabel.getParameter('Text').setValue(`<pointerLeave> event`)
          startBackToDefaultTextTimeout()
        })

        group.on('pointerDown', (event) => {
          event.stopPropagation()

          group.getParameter('Highlighted').setValue(true)
          groupEventItemLabel.getParameter('Text').setValue(`<pointerDown> event`)
          clearTimeout(goToDefaultTextTimeout)
          event.setCapture(group)
        })

        group.on('pointerUp', (event) => {
          event.stopPropagation()

          group.getParameter('Highlighted').setValue(false)
          groupEventItemLabel.getParameter('Text').setValue(`<pointerUp> event`)
          startBackToDefaultTextTimeout()
          event.releaseCapture()
        })

        scene.getRoot().addChild(group)
      }
      /** Group Events End */

      /** Pointer Events on viewport Start*/
      {
        const material4 = new Material('material4', 'SimpleSurfaceShader')
        material4.getParameter('BaseColor').setValue(new Color('#004B8D'))

        const vpEventItem = new GeomItem('vpEventItem', new Cone(0.5, 1), material4)
        const vpEventItemXfo = new Xfo()
        vpEventItemXfo.tr = new Vec3(-2, 0, 0.25)
        vpEventItem.getParameter('GlobalXfo').setValue(vpEventItemXfo)

        const labelDefaultText = 'Viewport Event Handling'
        const vpEventItemLabel = addLabel(new Vec3(-2, 0, 1.5), new Color('#004B8D'), labelDefaultText)

        let goToDefaultTextTimeout
        const startBackToDefaultTextTimeout = () => {
          goToDefaultTextTimeout = setTimeout(
            () => vpEventItemLabel.getParameter('Text').setValue(labelDefaultText),
            2000
          )
        }

        // Registering pointer event handlers directly to the geometry.

        renderer.getViewport().on('pointerLeaveGeom', (event) => {
          vpEventItemLabel.getParameter('Text').setValue(`<pointerLeaveGeom> event`)
          startBackToDefaultTextTimeout()
        })

        renderer.getViewport().on('pointerOverGeom', (event) => {
          vpEventItemLabel.getParameter('Text').setValue(`<pointerOverGeom> event`)
          clearTimeout(goToDefaultTextTimeout)
        })

        renderer.getViewport().on('pointerDownOnGeom', (event) => {
          vpEventItemLabel.getParameter('Text').setValue(`<pointerDownOnGeom> event`)
          clearTimeout(goToDefaultTextTimeout)
        })

        renderer.getViewport().on('pointerUp', (event) => {
          vpEventItemLabel.getParameter('Text').setValue(`<pointerUp> event`)
          startBackToDefaultTextTimeout()
        })
        scene.getRoot().addChild(vpEventItem)
      }
      /** Pointer Events on viewport End */

      renderer.setScene(scene)
      renderer.resumeDrawing()

      // Positioning the camera to a better perspective view
      renderer.getViewport().getCamera().setPositionAndTarget(new Vec3(0, 5, 3), new Vec3(0, 0, 0))
    </script>
  </body>
</html>
